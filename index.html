<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Agenda AI - Google Integration</title>
    
    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- ‚≠ê CONFIGURAZIONE CENTRALIZZATA - CARICA SEMPRE PER PRIMO -->
    <script src="config.js"></script>
    
    <!-- Il tuo CSS originale qui -->
    <style>
        /* ... tutto il tuo CSS originale rimane identico ... */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ... tutto il resto del tuo CSS ... */
        
        /* Nuovo stile per indicatori di configurazione */
        .config-status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            z-index: 9999;
            display: none;
        }
        
        .config-status.show { display: block; }
        .config-status.valid { background: rgba(39, 174, 96, 0.9); }
        .config-status.invalid { background: rgba(231, 76, 60, 0.9); }
        .config-status.warning { background: rgba(243, 156, 18, 0.9); }
    </style>
</head>
<body>
    <!-- Indicatore stato configurazione -->
    <div id="configStatus" class="config-status">
        üîß Caricamento configurazione...
    </div>

    <!-- Il tuo HTML originale qui -->
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <div class="header-left">
                <h1 id="appTitle">üéØ Agenda AI</h1>
                <div class="week-nav">
                    <button class="nav-btn" onclick="previousWeek()">‚Üê</button>
                    <div class="current-week" id="currentWeek"></div>
                    <button class="nav-btn" onclick="nextWeek()">‚Üí</button>
                    <button class="nav-btn" onclick="goToCurrentWeek()">Oggi</button>
                </div>
            </div>
            
            <div class="header-right">
                <div class="google-status">
                    <div class="google-indicator" id="googleIndicator"></div>
                    <span id="googleStatusText" style="font-size: 11px;">Google...</span>
                    <button class="google-auth-btn" id="googleAuthBtn" onclick="toggleGoogleAuth()">
                        üìß Connetti
                    </button>
                </div>
                
                <div class="sync-status">
                    <div class="sync-indicator" id="syncIndicator"></div>
                    <span id="syncStatusText" style="font-size: 11px;">DB...</span>
                </div>
            </div>
        </div>

        <!-- ... resto del tuo HTML originale ... -->
        
    </div>

    <script>
        console.log('üöÄ Caricamento Agenda AI con configurazione centralizzata...');

        // ========================================
        // üîß VERIFICA CONFIGURAZIONE ALL'AVVIO
        // ========================================
        
        function checkConfigurationStatus() {
            const statusEl = document.getElementById('configStatus');
            
            if (!window.CONFIG) {
                showConfigStatus('‚ùå Config.js non caricato!', 'invalid');
                return false;
            }
            
            const validation = validateConfig();
            
            if (!validation.isValid) {
                showConfigStatus(`‚ùå ${validation.errors.length} errori configurazione`, 'invalid');
                return false;
            } else if (validation.warnings.length > 0) {
                showConfigStatus(`‚ö†Ô∏è ${validation.warnings.length} avvisi configurazione`, 'warning');
                return true;
            } else {
                showConfigStatus('‚úÖ Configurazione OK', 'valid');
                setTimeout(() => hideConfigStatus(), 3000);
                return true;
            }
        }
        
        function showConfigStatus(message, type) {
            const statusEl = document.getElementById('configStatus');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.className = `config-status show ${type}`;
            }
        }
        
        function hideConfigStatus() {
            const statusEl = document.getElementById('configStatus');
            if (statusEl) {
                statusEl.classList.remove('show');
            }
        }

        // ========================================
        // üîó INIZIALIZZAZIONE CON CONFIG
        // ========================================
        
        // Variabili globali ora inizializzate da CONFIG
        let currentWeekStart = new Date();
        let selectedDate = new Date();
        let tasksData = [];
        let clientsData = [];
        let projectsData = [];
        let routinesData = [];
        let googleEvents = [];
        let emailTasks = [];
        let isGoogleConnected = false;
        let isDbConnected = false;
        let currentAISuggestion = null;

        // ========================================
        // üìß GOOGLE INTEGRATION (Aggiornato per CONFIG)
        // ========================================

        class GoogleIntegration {
            constructor() {
                this.isSignedIn = false;
                this.auth2 = null;
                this.config = CONFIG.google; // Usa configurazione centralizzata
                this.init();
            }

            async init() {
                try {
                    showNotification('üîÑ Inizializzando Google APIs...', 'info');
                    
                    // Verifica configurazione
                    if (!this.config.apiKey || this.config.apiKey.startsWith('TUA_')) {
                        throw new Error('‚ùå Google API Key non configurata in config.js');
                    }
                    
                    if (!this.config.clientId || this.config.clientId.startsWith('TUO_')) {
                        throw new Error('‚ùå Google Client ID non configurato in config.js');
                    }
                    
                    await this.loadGoogleAPIs();
                    await this.initializeGoogleAuth();
                    
                    updateGoogleStatus('connected');
                    showNotification('‚úÖ Google APIs inizializzate!', 'success');
                    
                } catch (error) {
                    console.error('Errore inizializzazione Google:', error);
                    updateGoogleStatus('error');
                    showNotification(error.message, 'error');
                    this.showConfigurationHelp();
                }
            }

            loadGoogleAPIs() {
                return new Promise((resolve, reject) => {
                    if (typeof gapi !== 'undefined') {
                        gapi.load('auth2:client', resolve);
                    } else {
                        reject(new Error('Google APIs non caricate. Verifica connessione internet.'));
                    }
                });
            }

            async initializeGoogleAuth() {
                await gapi.client.init({
                    apiKey: this.config.apiKey,
                    clientId: this.config.clientId,
                    discoveryDocs: [
                        'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest',
                        'https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest'
                    ],
                    scope: this.config.scopes.join(' ')
                });

                this.auth2 = gapi.auth2.getAuthInstance();
                this.isSignedIn = this.auth2.isSignedIn.get();

                // Listener per cambio stato autenticazione
                this.auth2.isSignedIn.listen((isSignedIn) => {
                    this.isSignedIn = isSignedIn;
                    isGoogleConnected = isSignedIn;
                    updateGoogleAuthButton();
                    
                    if (isSignedIn) {
                        showNotification('‚úÖ Google autenticato con successo!', 'success');
                        this.loadGoogleData();
                    } else {
                        showNotification('‚ùå Disconnesso da Google', 'warning');
                    }
                });

                isGoogleConnected = this.isSignedIn;
                updateGoogleAuthButton();

                if (this.isSignedIn) {
                    await this.loadGoogleData();
                }
            }

            showConfigurationHelp() {
                console.error('üîß CONFIGURAZIONE GOOGLE RICHIESTA:');
                console.error('1. Apri config.js');
                console.error('2. Inserisci la tua Google API Key');
                console.error('3. Inserisci il tuo Google Client ID');
                console.error('4. Configura il tuo indirizzo Gmail');
                console.error('5. Verifica che i domini siano autorizzati in Google Cloud Console');
                
                if (CONFIG.app.debug) {
                    console.error('Domini autorizzati configurati:', this.config.authorizedDomains);
                }
            }

            async signIn() {
                try {
                    await this.auth2.signIn();
                } catch (error) {
                    console.error('Errore sign-in Google:', error);
                    showNotification('‚ùå Errore autenticazione Google', 'error');
                }
            }

            async signOut() {
                try {
                    await this.auth2.signOut();
                    googleEvents = [];
                    emailTasks = [];
                    generateWeeklyCalendar();
                } catch (error) {
                    console.error('Errore sign-out Google:', error);
                }
            }

            async loadGoogleData() {
                try {
                    updateGoogleStatus('syncing');
                    showNotification('üîÑ Sincronizzando dati Google...', 'info');
                    
                    const [events, emails] = await Promise.all([
                        this.getCalendarEvents(),
                        this.analyzeGmailForTasks()
                    ]);
                    
                    googleEvents = events || [];
                    emailTasks = emails || [];
                    
                    generateWeeklyCalendar();
                    updateDashboardStats();
                    updateGoogleTab();
                    
                    updateGoogleStatus('connected');
                    document.getElementById('lastGoogleSync').textContent = new Date().toLocaleTimeString('it-IT');
                    showNotification(`‚úÖ Sincronizzati ${googleEvents.length} eventi e ${emailTasks.length} email`, 'success');
                    
                } catch (error) {
                    console.error('Errore caricamento dati Google:', error);
                    updateGoogleStatus('error');
                    showNotification('‚ùå Errore sincronizzazione Google', 'error');
                }
            }

            async getCalendarEvents() {
                try {
                    const startTime = new Date(currentWeekStart).toISOString();
                    const endTime = new Date(currentWeekStart.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString();
                    
                    const response = await gapi.client.calendar.events.list({
                        calendarId: this.config.calendarId,
                        timeMin: startTime,
                        timeMax: endTime,
                        singleEvents: true,
                        orderBy: 'startTime'
                    });

                    return response.result.items || [];
                } catch (error) {
                    console.error('Errore caricamento eventi calendar:', error);
                    return [];
                }
            }

            // ... resto dei metodi rimangono identici al codice originale ...
        }

        // ========================================
        // üóÑÔ∏è DATABASE MANAGER (Aggiornato per CONFIG)
        // ========================================

        class AgendaDatabase {
            constructor() {
                this.config = CONFIG.supabase; // Usa configurazione centralizzata
                this.isOnline = navigator.onLine;
                this.localStorageKey = 'agenda_offline_data';
                this.supabase = null;
                this.init();
            }

            async init() {
                try {
                    // Verifica configurazione Supabase
                    if (!this.config.url || this.config.url.startsWith('https://tuo-')) {
                        console.warn('‚ö†Ô∏è Supabase non configurato - modalit√† offline');
                        isDbConnected = false;
                        updateSyncStatus('disconnected');
                        this.loadDemoData();
                        return;
                    }

                    if (!this.config.anonKey || this.config.anonKey.startsWith('tua-')) {
                        console.warn('‚ö†Ô∏è Supabase Anon Key mancante - modalit√† offline');
                        isDbConnected = false;
                        updateSyncStatus('disconnected');
                        this.loadDemoData();
                        return;
                    }

                    // Inizializza Supabase
                    this.supabase = window.supabase.createClient(this.config.url, this.config.anonKey);
                    await this.testConnection();
                    
                } catch (error) {
                    console.error('Errore inizializzazione database:', error);
                    isDbConnected = false;
                    updateSyncStatus('error');
                    this.loadDemoData();
                }
            }

            async testConnection() {
                try {
                    showNotification('üîÑ Testando connessione Supabase...', 'info');
                    updateSyncStatus('connecting');
                    
                    const { data, error } = await this.supabase
                        .from(this.config.tables.tasks)
                        .select('count')
                        .limit(1);
                    
                    if (error) throw error;
                    
                    isDbConnected = true;
                    updateSyncStatus('connected');
                    showNotification('‚úÖ Supabase connesso!', 'success');
                    
                    await this.loadInitialData();
                    
                } catch (error) {
                    console.error('Supabase non connesso:', error);
                    isDbConnected = false;
                    updateSyncStatus('error');
                    showNotification('‚ö†Ô∏è Database offline - modalit√† demo', 'warning');
                    this.loadDemoData();
                }
            }

            // ... resto dei metodi database rimangono identici ...
        }

        // ========================================
        // üé¨ INIZIALIZZAZIONE PRINCIPALE (Aggiornata)
        // ========================================

        async function init() {
            console.log('üîÑ Inizializzazione Agenda AI con configurazione centralizzata...');
            
            try {
                // 1. Verifica configurazione
                if (!checkConfigurationStatus()) {
                    throw new Error('Configurazione non valida. Controlla config.js');
                }
                
                // 2. Applica configurazione app
                if (CONFIG.app.name) {
                    document.getElementById('appTitle').textContent = `üéØ ${CONFIG.app.name}`;
                    document.title = `${CONFIG.app.name} - v${CONFIG.app.version}`;
                }
                
                // 3. Setup date e timezone
                if (CONFIG.app.timezone) {
                    console.log(`‚è∞ Timezone: ${CONFIG.app.timezone}`);
                }
                
                currentWeekStart = getWeekStart(new Date());
                selectedDate = new Date();
                
                // 4. Inizializza componenti
                console.log('üîß Inizializzando componenti...');
                
                db = new AgendaDatabase();
                aiScheduler = new AIScheduler();
                googleIntegration = new GoogleIntegration();
                
                // 5. Setup UI
                const taskDateField = document.getElementById('taskDate');
                if (taskDateField) {
                    taskDateField.value = formatDateKey(selectedDate);
                }
                
                setupEventListeners();
                
                // 6. Auto-sync se configurato
                if (CONFIG.app.autoSyncInterval > 0) {
                    setInterval(autoSync, CONFIG.app.autoSyncInterval * 60 * 1000);
                    console.log(`üîÑ Auto-sync ogni ${CONFIG.app.autoSyncInterval} minuti`);
                }
                
                console.log(`‚úÖ ${CONFIG.app.name} v${CONFIG.app.version} inizializzato`);
                
                // 7. Comandi debug se attivi
                if (CONFIG.app.debug) {
                    setupDebugCommands();
                }
                
            } catch (error) {
                console.error('‚ùå Errore inizializzazione:', error);
                showNotification('‚ùå Errore: ' + error.message, 'error');
                showConfigurationHelp();
            }
        }

        function setupDebugCommands() {
            window.AGENDA_DEBUG = {
                showConfig: () => console.table(CONFIG),
                validateConfig: validateConfig,
                runDiagnostics: runConfigDiagnostics,
                testGoogle: () => googleIntegration?.testConnection(),
                testSupabase: () => db?.testConnection(),
                refreshAll: refreshAllData,
                exportData: () => exportToJSON(),
                showTasks: () => console.table(tasksData),
                showEvents: () => console.table(googleEvents),
                clearCache: () => {
                    localStorage.clear();
                    sessionStorage.clear();
                    console.log('‚úÖ Cache pulita');
                },
                version: CONFIG.app.version
            };
            
            console.log('üêõ Debug commands disponibili in AGENDA_DEBUG:');
            console.log('   - AGENDA_DEBUG.showConfig() - Mostra configurazione');
            console.log('   - AGENDA_DEBUG.runDiagnostics() - Diagnostica completa');
            console.log('   - AGENDA_DEBUG.testGoogle() - Test Google APIs');
            console.log('   - AGENDA_DEBUG.testSupabase() - Test Supabase');
            console.log('   - AGENDA_DEBUG.refreshAll() - Ricarica tutti i dati');
        }

        async function autoSync() {
            if (!CONFIG.app.autoSyncInterval) return;
            
            try {
                console.log('üîÑ Auto-sync in corso...');
                if (isGoogleConnected && googleIntegration) {
                    await googleIntegration.loadGoogleData();
                }
                if (isDbConnected && db) {
                    await db.loadTasksForWeek();
                }
                generateWeeklyCalendar();
                console.log('‚úÖ Auto-sync completato');
            } catch (error) {
                console.error('‚ùå Errore auto-sync:', error);
            }
        }

        function showConfigurationHelp() {
            const helpText = `
üîß CONFIGURAZIONE RICHIESTA

Per far funzionare l'Agenda AI, devi configurare config.js con le tue credenziali:

1. üìß GOOGLE APIS:
   - Vai su Google Cloud Console
   - Crea API Key e OAuth Client ID
   - Abilita Calendar API e Gmail API

2. üóÑÔ∏è SUPABASE (opzionale):
   - Crea progetto su Supabase
   - Copia URL e Anon Key

3. üêô GITHUB:
   - Inserisci username e repository

Apri la console per dettagli tecnici.
            `;
            
            console.group('üîß GUIDA CONFIGURAZIONE');
            console.log(helpText);
            console.log('üìÅ File da modificare: config.js');
            console.log('üîç Esegui runConfigDiagnostics() per verificare lo stato');
            console.groupEnd();
        }

        // ========================================
        // üõ†Ô∏è FUNZIONI UTILIT√Ä AGGIORNATE
        // ========================================

        function showNotification(message, type = 'info') {
            const bar = document.getElementById('notificationBar');
            if (!bar) {
                console.log(`NOTIFICATION [${type.toUpperCase()}]: ${message}`);
                return;
            }
            
            bar.className = `notification-bar show ${type}`;
            bar.textContent = message;
            
            const duration = CONFIG.ui?.notifications?.duration || 4000;
            setTimeout(() => {
                bar.classList.remove('show');
            }, duration);
        }

        function updateSyncStatus(status) {
            const indicator = document.getElementById('syncIndicator');
            const text = document.getElementById('syncStatusText');
            
            if (!indicator || !text) return;
            
            indicator.className = `sync-indicator ${status}`;
            
            const statusTexts = {
                'connecting': 'Connettendo...',
                'connected': 'Online',
                'syncing': 'Sincronizzando...',
                'error': 'Offline',
                'disconnected': 'Disconnesso'
            };
            
            text.textContent = statusTexts[status] || 'Sconosciuto';
        }

        function updateGoogleStatus(status) {
            const indicator = document.getElementById('googleIndicator');
            const text = document.getElementById('googleStatusText');
            
            if (!indicator || !text) return;
            
            indicator.className = `google-indicator ${status}`;
            
            const statusTexts = {
                'connecting': 'Connettendo...',
                'connected': 'Connesso',
                'syncing': 'Sincronizzando...',
                'error': 'Errore',
                'disconnected': 'Disconnesso'
            };
            
            text.textContent = statusTexts[status] || 'Google';
        }

        function updateGoogleAuthButton() {
            const btn = document.getElementById('googleAuthBtn');
            if (!btn) return;
            
            if (isGoogleConnected) {
                btn.innerHTML = '‚úÖ Connesso';
                btn.onclick = () => googleIntegration?.signOut();
            } else {
                btn.innerHTML = 'üìß Connetti';
                btn.onclick = () => googleIntegration?.signIn();
            }
        }

        // ========================================
        // üìÖ FUNZIONI CALENDARIO (Invariate ma con logging migliorato)
        // ========================================

        function formatDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDateDisplay(date) {
            const options = { 
                weekday: 'long', 
                day: 'numeric',
                month: 'long'
            };
            return date.toLocaleDateString(CONFIG.app.defaultLanguage || 'it-IT', options);
        }

        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(d.setDate(diff));
        }

        // ========================================
        // üìä EXPORT/IMPORT AVANZATO
        // ========================================

        async function exportToJSON() {
            try {
                const exportData = {
                    metadata: {
                        appName: CONFIG.app.name,
                        version: CONFIG.app.version,
                        exportDate: new Date().toISOString(),
                        timezone: CONFIG.app.timezone
                    },
                    data: {
                        tasks: tasksData,
                        clients: clientsData,
                        projects: projectsData,
                        routines: routinesData,
                        googleEvents: googleEvents.length > 0 ? googleEvents : null,
                        emailTasks: emailTasks.length > 0 ? emailTasks : null
                    },
                    settings: {
                        workingHours: CONFIG.app.workingHours,
                        calendarSettings: CONFIG.ui.calendar
                    }
                };

                const jsonString = JSON.stringify(exportData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `agenda_ai_backup_${formatDateKey(new Date())}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                showNotification('üìÑ Backup JSON esportato!', 'success');
                
            } catch (error) {
                console.error('Errore export JSON:', error);
                showNotification('‚ùå Errore export JSON', 'error');
            }
        }

        async function exportToCSV() {
            try {
                const csvData = ['Data,Ora,Titolo,Tipo,Cliente,Durata,Fonte,Status'];
                
                // Esporta task
                tasksData.forEach(task => {
                    const row = [
                        task.task_date || '',
                        task.task_time || '',
                        `"${(task.title || '').replace(/"/g, '""')}"`,
                        task.type || '',
                        `"${(task.client_name || '').replace(/"/g, '""')}"`,
                        task.duration_hours || '',
                        task.source || 'manual',
                        task.status || ''
                    ].join(',');
                    csvData.push(row);
                });
                
                // Esporta eventi Google se disponibili
                if (googleEvents.length > 0) {
                    csvData.push('\n# Google Calendar Events');
                    googleEvents.forEach(event => {
                        if (event.start?.dateTime) {
                            const startDate = new Date(event.start.dateTime);
                            const row = [
                                formatDateKey(startDate),
                                startDate.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' }),
                                `"${(event.summary || '').replace(/"/g, '""')}"`,
                                'google-event',
                                '',
                                '',
                                'google',
                                'active'
                            ].join(',');
                            csvData.push(row);
                        }
                    });
                }

                const csvString = csvData.join('\n');
                const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `agenda_ai_export_${formatDateKey(new Date())}.csv`;
                link.click();
                
                URL.revokeObjectURL(url);
                showNotification('üìä CSV esportato con successo!', 'success');
                
            } catch (error) {
                console.error('Errore export CSV:', error);
                showNotification('‚ùå Errore export CSV', 'error');
            }
        }

        // ========================================
        // üöÄ FUNZIONI API PUBBLICHE
        // ========================================

        async function toggleGoogleAuth() {
            if (!googleIntegration) {
                showNotification('‚ùå Google APIs non inizializzate', 'error');
                return;
            }

            if (isGoogleConnected) {
                await googleIntegration.signOut();
            } else {
                await googleIntegration.signIn();
            }
        }

        async function refreshAllData() {
            try {
                showNotification('üîÑ Aggiornando tutti i dati...', 'info');
                
                if (db) await db.loadInitialData();
                if (isGoogleConnected && googleIntegration) await googleIntegration.loadGoogleData();
                
                generateWeeklyCalendar();
                updateDashboardStats();
                
                showNotification('‚úÖ Tutti i dati aggiornati!', 'success');
                
            } catch (error) {
                console.error('Errore refresh dati:', error);
                showNotification('‚ùå Errore aggiornamento', 'error');
            }
        }

        // ========================================
        // üì± EVENT LISTENERS E RESPONSIVE
        // ========================================

        function setupEventListeners() {
            // Online/Offline events
            window.addEventListener('online', () => {
                updateSyncStatus('connected');
                showNotification('üü¢ Connessione ripristinata', 'success');
                if (db) db.testConnection();
            });

            window.addEventListener('offline', () => {
                updateSyncStatus('disconnected');
                showNotification('üî¥ Modalit√† offline', 'warning');
            });

            // Gestione errori globali
            window.addEventListener('error', (event) => {
                if (CONFIG.app.debug) {
                    console.error('üêõ Errore globale:', event.error);
                }
            });

            // Gestione promesse rifiutate
            window.addEventListener('unhandledrejection', (event) => {
                if (CONFIG.app.debug) {
                    console.error('üêõ Promise rejection:', event.reason);
                }
            });
        }

        // ========================================
        // üéØ PLACEHOLDER PER FUNZIONI MANCANTI
        // ========================================
        
        // Queste funzioni devono essere implementate basandoti sul tuo codice originale
        function generateWeeklyCalendar() {
            console.log('üìÖ Generazione calendario settimanale...');
            // TODO: Implementa la logica del calendario
        }

        function updateDashboardStats() {
            console.log('üìä Aggiornamento statistiche dashboard...');
            // TODO: Implementa aggiornamento statistiche
        }

        function updateGoogleTab() {
            console.log('üìß Aggiornamento tab Google...');
            // TODO: Implementa aggiornamento interfaccia Google
        }

        function previousWeek() {
            currentWeekStart.setDate(currentWeekStart.getDate() - 7);
            generateWeeklyCalendar();
        }

        function nextWeek() {
            currentWeekStart.setDate(currentWeekStart.getDate() + 7);
            generateWeeklyCalendar();
        }

        function goToCurrentWeek() {
            currentWeekStart = getWeekStart(new Date());
            selectedDate = new Date();
            generateWeeklyCalendar();
        }

        // Classi AI Scheduler e altre funzioni dal tuo codice originale
        class AIScheduler {
            constructor() {
                this.workingHours = CONFIG.app.workingHours;
                console.log('ü§ñ AI Scheduler inizializzato');
            }
            // TODO: Implementa metodi AI Scheduler
        }

        // ========================================
        // üé¨ INIZIALIZZAZIONE FINALE
        // ========================================

        document.addEventListener('DOMContentLoaded', function() {
            console.log(`=== ${CONFIG?.app?.name || 'AGENDA AI'} ===`);
            
            // Attendi che config.js sia completamente caricato
            if (typeof CONFIG === 'undefined') {
                console.error('‚ùå config.js non caricato!');
                showNotification('‚ùå Errore: config.js non trovato', 'error');
                return;
            }
            
            try {
                init();
                
                // Messaggi informativi dopo l'inizializzazione
                setTimeout(() => {
                    if (!isDbConnected) {
                        showNotification('üí° TIP: Configura Supabase in config.js per salvare i dati', 'info');
                    }
                    
                    setTimeout(() => {
                        if (!isGoogleConnected) {
                            showNotification('üìß TIP: Clicca "Connetti" per sincronizzare Google Calendar', 'info');
                        }
                    }, 2000);
                }, 3000);
                
            } catch (error) {
                console.error('Errore caricamento:', error);
                showNotification('‚ùå Errore caricamento applicazione', 'error');
            }
        });

        // Log finale
        console.log('üéâ Agenda AI JavaScript caricato con configurazione centralizzata!');
        console.log('üí° Comandi disponibili nella console:');
        console.log('   - runConfigDiagnostics() - Diagnostica configurazione');
        console.log('   - validateConfig() - Valida configurazione');
        console.log('   - AGENDA_DEBUG - Comandi debug (se attivo)');
    </script>
</body>
</html>
